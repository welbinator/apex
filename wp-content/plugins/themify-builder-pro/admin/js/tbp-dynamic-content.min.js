'use strict';(function(l,k){let d={},n=null,p;const u={},q=tbpDynamic.field_name,x=function(a){if(null===n){const c=Themify.hash(tbpDynamic.v+Object.keys(tbpDynamic.items));n=function(){if(themifyBuilder.debug)return null;try{let a=sessionStorage.getItem("tbp_dc");if(a&&(a=JSON.parse(a),a.h===c&&a.v))return a.v}catch(b){}return null}();null===n&&l.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tpb_get_dynamic_content_fields",tb_load_nonce:themifyBuilder.tb_load_nonce},
error:function(){n=null},success:function(b){n=b;try{sessionStorage.setItem("tbp_dc",JSON.stringify({v:b,h:c}))}catch(f){}a&&a()}})}else a&&a()},D=function(a,c){let b="",f="";const e=function(a){if(void 0!==f||void 0!==b)a||(a=""),void 0!==f&&(a=f+a),void 0!==b&&(a+=b);c&&c(a)};if("string"!==typeof a){if(!a||void 0===a.item)return;a=l.extend(!0,{},a);b=a.text_after;f=a.text_before;delete a.text_before;delete a.text_after;delete a.o;a=JSON.stringify(a)}let g;k.Forms.LayoutPart.id&&document.body.classList.contains("tbp_app_is_edit")&&
(g=k.Instances.Builder[k.builderIndex].el.parentNode.id)&&(g=g.split("-")[1]);g||(g="undefined"===typeof tbp_local||void 0===tbp_local.id||tbp_local.isArchive?themifyBuilder.post_ID:tbp_local.id);const d=Themify.hash(a+g);void 0===u[d]?l.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tpb_get_dynamic_content_preview",tb_load_nonce:themifyBuilder.tb_load_nonce,pid:g,values:a},success:function(a){u[d]=a.error?a.error:""===a.value||"false"===a.value?null:a.value;e(u[d])}}):
e(u[d])},E=function(a,c){const b=ThemifyConstructor.values,f=document.createElement("div");var e=Object.values(l.extend(!0,{},n));const g=tbpDynamic.items;f.className="tbp_dynamic_content_options";for(var d=e.length-1;-1<d;--d)if("item"===e[d].id){d=e[d].options;for(let b in d){for(let e in d[b].options)void 0!==g[e]&&-1===g[e].type.indexOf(a)&&delete d[b].options[e];0===Object.keys(d[b].options).length&&delete d[b]}break}void 0===c&&(c={});ThemifyConstructor.values=c;a=ThemifyConstructor.create(e);
c=a.querySelectorAll(".tb_lb_option");for(e=c.length-1;-1<e;--e)c[e].classList.remove("tb_lb_option","tb_lb_option_child");ThemifyConstructor.values=b;f.appendChild(a);return f},C=function(a,c){let b=a.parentNode.closest(".tb_field"),f=v(b),e=F(b);var g=b.getElementsByClassName("tb_input")[0];let m={};void 0!==g&&g.parentNode.classList.contains("tb_has_dc")&&(b=g,g=null);const h=G(b,e);null!==f?void 0!==d[f]&&(g=w(b),void 0!==d[f][g]&&(m=d[f][g])):m=d;if(!0===c)if(void 0!==m[h])a.checked=!0;else return;
if(!0===a.checked){b.classList.add("tbp_dc_active");let a=b.getElementsByClassName("tbp_dc_input")[0];void 0===a?(x(function(){const c=document.createElement("div");a=document.createElement("input");c.className="tbp_dc_wrap";a.className="tbp_dc_input xlarge";a.type="text";a.setAttribute("readonly",!0);const d=function(b){b=b.closest(".tbp_dc_wrap");const c=b.querySelector("#item"),d=c.value,f=c.closest(".tb_field").nextElementSibling.children,g="field_"+d,m="field_general_"+e;let r=[];a.value=c.options[c.selectedIndex].text;
r.push(c.parentNode);for(let a=f.length-1;-1<a;--a)""!==d&&(f[a].classList.contains(g)||f[a].classList.contains(m))?(f[a].style.display="block",r.push(f[a])):f[a].style.display="";ThemifyConstructor.callbacks();d||(r=null);const k=y(h,r,b);r=null;D(k,function(a){null===a&&(a="image"===e?tbpDynamic.placeholder_image:"{"+k.item+"}");const b=t(c,h);if(null!==b){b.value=a;let c=null;"wp_editor"===e&&(c=tinymce.get(b.id))&&(c.setContent(String(a)),c.fire("change"));c||(Themify.triggerEvent(b,"change"),
"image"!==e&&"SELECT"!==b.nodeName&&Themify.triggerEvent(b,"keyup"))}})};a.addEventListener("click",function(a){a.preventDefault();a.stopImmediatePropagation();let b=this.nextElementSibling;null===b&&(b=E(e,m[h]),l(b).on("change.dc_preview",":input",function(a){a.stopPropagation();d(a.target)}),this.parentNode.appendChild(b));a="block"!==b.style.display;const c=ThemifyBuilderCommon.Lightbox.$lightbox[0].getElementsByClassName("tbp_dynamic_content_options");for(let a=c.length-1;-1<a;--a)c[a].style.display=
"";if(!0===a){const a=function(c){null===c.target.closest(".tbp_dc_wrap")&&(document.removeEventListener("mousedown",a,{passive:!0}),"visual"===k.mode&&window.top.document.removeEventListener("mousedown",a,{passive:!0}),b.style.display="");"visual"===k.mode&&l(document).triggerHandler("mouseup")};document.addEventListener("mousedown",a,{passive:!0});"visual"===k.mode&&window.top.document.addEventListener("mousedown",a,{passive:!0});d(this);b.style.display="block"}else b.style.display=""});c.appendChild(k.Utils.getIcon("ti-pencil"));
c.appendChild(a);if(void 0!==m[h]){var f=m[h].item,g=n[0].options;for(let b in g)if(void 0!==g[b].options[f]){a.value=g[b].options[f];break}if("image"===e&&"styling"===ThemifyConstructor.clicked)for(f=b.closest(".tb_tab").getElementsByClassName("tb_image_options"),g=f.length-1;-1<g;--g)f[g].classList.remove("_tb_hide_binding");else ThemifyConstructor.callbacks()}b.appendChild(c)}),void 0===c&&A(b,h,e)):void 0===c&&(A(b,h,e),void 0!==m[h]&&a.click(),B(!1))}else void 0===c&&(H(b,h,e),b.classList.remove("tbp_dc_active"),
y(h,null,b),B(!0))},w=function(a){return l(a.closest(".tb_repeatable_field")).index()},v=function(a){a=a.parentNode.closest(".tb_row_js_wrapper");return null!==a?a.getAttribute("id"):null},B=function(a){if("visual"===k.mode&&"styling"===ThemifyConstructor.clicked){var c=k.liveStylingInstance.$liveStyledElmt[0].closest(".tb_active_layout_part");null===c&&(c=k.liveStylingInstance.$liveStyledElmt[0]);c=c.getElementsByClassName("tbp_dc_styles");for(let b=c.length-1;-1<b;--b)c[b].sheet.disabled=a}},G=
function(a,c){c="image"===c?"tb_uploader_input":null!==a.parentNode.closest(".tb_repeatable_field_content")?"tb_lb_option_child":"tb_lb_option";a=a.getElementsByClassName(c)[0];let b;void 0!==a&&(b=a.getAttribute("data-input-id"));b||(b=a.getAttribute("id"));return b.trim()},y=function(a,c,b){let f=null,e=v(b);null!==e&&(f=w(b));if(null===c)if((b=(b=p.value)?JSON.parse(b):{})||(b={}),null!==f){var g=!1;if(void 0!==b[e]){if(null===a)void 0!==b[e][f]&&(g=!0,delete d[e][f],delete b[e][f]);else if(void 0!==
b[e][f]&&void 0!==b[e][f][a]){if(g=!0,delete b[e][f][a],a=Object.keys(b[e][f]).length,0===a||1===a&&void 0!==b[e][f].o)g=!0,delete d[e][f],delete b[e][f]}else return;if(0===Object.keys(b[e]).length||1===Object.keys(b[e]).length&&void 0!==b[e].repeatable)g=!0,delete d[e],delete b[e]}if(!1===g)return}else if(void 0!==b[a])delete b[a];else return;else{null!==f?(void 0===d[e]&&(d[e]={}),d[e].repeatable=1,void 0===d[e][f]&&(d[e][f]={}),void 0===d[e][f][a]&&(d[e][f][a]={}),b=void 0!==d[e][f][a].o?d[e][f][a].o:
null):(void 0===d[a]&&(d[a]={}),b=void 0!==d[a].o?d[a].o:null);if(Array.isArray(c)){g={};for(let a=c.length-1;-1<a;--a){let b=c[a].querySelectorAll("input,textarea,select");for(let a=b.length-1;-1<a;--a){let c=b[a].value;""===c||b[a].parentNode.parentNode.classList.contains("_tb_hide_binding")||(g[b[a].id]=c)}}c=k.Utils.clear(g)}null!==f?(d[e][f][a]=c,null!==b&&(d[e][f][a].o=b)):(d[a]=c,null!==b&&(d[a].o=b));b=d}p.value=JSON.stringify(b);return c},t=function(a,c){a=a.closest(".tb_repeatable_field_content");
return a=null!==a?a.querySelector('.tb_lb_option_child[data-input-id="'+c+'"]'):ThemifyBuilderCommon.Lightbox.$lightbox[0].querySelector("#"+c)},A=function(a,c,b){let f=null,e=null,g=c;"wp_editor"===b?((b=tinymce.get(c))||(b=tinymce.get(t(a,c).id)),b&&(f=b.getContent())):(b=t(a,c),null!==b&&(f=b.value));b=v(a);null!==b&&(e=w(a),g=b);null!==f&&""!==f?(void 0===d[g]&&(d[g]={}),null!==e?(void 0===d[g][e]&&(d[g][e]={}),void 0===d[g][e][c]&&(d[g][e][c]={}),d[g][e][c].o=f):d[g].o=f):void 0!==d[g]&&(null!==
e?void 0!==d[g][e]&&void 0!==d[g][e][c]&&delete d[g][e][c].o:delete d[g].o);p.value=JSON.stringify(d);return f},H=function(a,c,b){let f=v(a),e="";if(null!==f){if(void 0!==d[f]){const b=w(a);void 0!==d[f][b]&&void 0!==d[f][b][c]&&void 0!==d[f][b][c].o&&(e=d[f][b][c].o)}}else void 0!==d[c]&&void 0!==d[c].o&&(e=d[c].o);"wp_editor"===b?((b=tinymce.get(c))||(b=tinymce.get(t(a,c).id)),b&&(b.setContent(String(e)),b.fire("change"))):(a=t(a,c),null!==a&&(a.value=e,Themify.triggerEvent(a,"change"),"image"!==
b&&"SELECT"!==a.nodeName&&Themify.triggerEvent(a,"keyup")))},F=function(a){a=a.getAttribute("data-type");"imageGradient"===a?a="image":"title"===a&&(a="text");return a},I=function(){const a={};l.each(tbpDynamic.items,function(c,b){l.each(b.type,function(b,c){void 0===a[c]&&(a[c]=c)})});a.title="title";a.imageGradient="imageGradient";return Object.keys(a)},z=function(a,c=[]){const b=tbpDynamic.excludes,f=tbpDynamic.d_label;0===c.length&&(c=I());var e=!1;for(let g=c.length-1;-1<g;--g){let h=a.querySelectorAll('.tb_field[data-type="'+
c[g]+'"]');for(let a=h.length-1;-1<a;--a)if(!h[a].classList.contains("tb_has_dc")&&!h[a].classList.contains("tb_disable_dc")){e=!1;for(var d=b.length-1;-1<d;--d)if(h[a].classList.contains(b[d])){e=!0;break}if(!1===e){h[a].className+=" tb_has_dc";e=document.createElement("label");d=document.createElement("input");let b=document.createElement("div");e.className="tpb_dc_toggle switch-wrapper";d.type="checkbox";d.className="toggle_switch";b.className="switch_label";b.setAttribute("data-on",f);b.setAttribute("data-off",
f);d.addEventListener("change",function(a){a.stopPropagation();C(this)},{passive:!0});e.appendChild(d);e.appendChild(b);h[a].insertBefore(e,h[a].firstChild);C(d,!0)}}}};l(window).one("load",function(){Themify.requestIdleCallback(function(){if("visual"!==k.mode||!0===Themify.is_builder_loaded)setTimeout(x,1500);else window.top.Themify.body.one("themify_builder_ready",function(a){setTimeout(x,2500)});l(document).on("tb_repeatable_add_new tb_repeatable_duplicate tb_repeatable_delete",function(a){"tb_repeatable_delete"===
a.type?y(null,null,a.detail[0]):z(a.detail[0])}).on("tb_editing_module tb_editing_row tb_editing_column tb_editing_subrow",function(a){a=ThemifyConstructor;const c=ThemifyBuilderCommon.Lightbox.$lightbox[0];p=a.hidden.render({type:"hidden","class":"exclude-from-reset-field",responsive:!1,control:!1,id:q},a);if(void 0!==a.values[q])try{d="string"===typeof a.values[q]?JSON.parse(a.values[q]):l.extend(!0,{},a.values[q]),p.value=JSON.stringify(d)}catch(b){d={}}else d={};c.getElementsByClassName("tb_options_tab_content")[0].appendChild(p);
z(c)});Themify.body.on("themify_builder_tabsactive tb_options_expand",function(a,c,b){if(null!==k.activeModel){let d=ThemifyConstructor.clicked;setTimeout(function(){d=ThemifyConstructor.clicked;"animation"!==d&&"visibility"!==d&&("tb_options_expand"===a.type&&(b=c,c=null),"styling"===d&&null!==c&&-1!==c.indexOf("_h")||z(b,"styling"===d?["imageGradient","image"]:[]))},"setting"===d?0:50)}})},15)})})(jQuery,tb_app);
