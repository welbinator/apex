'use strict';(function(f,k,g,b){let d=!1;const h=g.createElement,c={stateInit:!1,number:0,tempHTML:null,isRendered(){return null!==document.getElementById("tb_toolbar")},saveHTML(a){this.isRendered()&&(this.tempHTML=document.getElementById("tb_canvas_block").innerHTML)},restoreHTML(a){if("undefined"!==typeof tb_app&&this.tempHTML&&!this.isRendered()&&document.getElementById("tb_canvas_block")&&(document.getElementById("tb_canvas_block").innerHTML=this.tempHTML,tb_app.Instances.Builder[0])){a=document.getElementById("tb_row_wrapper").querySelectorAll("[data-cid]");
a=Array.prototype.slice.call(a);for(let b=a.length-1;-1<b;--b){let c=tb_app.Models.Registry.lookup(a[b].getAttribute("data-cid"));c&&c.trigger("change:view",a[b])}tb_app.toolbar.setElement(b("#tb_toolbar")).render();tb_app.toolbarCallback();tb_app.Instances.Builder[0].setElement(b("#tb_row_wrapper"));tb_app.Instances.Builder[0].init(!0)}},manageState(a){"undefined"===typeof tb_app||this.stateInit||(this.stateInit=!0,tb_app.vent.on("dom:change",function(){tb_app.hasChanged&&a.setAttributes({data:c.number++})}),
tb_app.vent.on("backend:switchfrontend",function(a){window.top.location.href=a}),document.getElementById("block-"+a.clientId).removeAttribute("tabIndex"))},saveBlock(){"undefined"!==typeof tb_app&&(d?d=!1:tb_app.hasChanged?tb_app.Utils.saveBuilder(this.goToFrontend):this.goToFrontend())},goToFrontend(){tb_app.redirectFrontend&&tb_app.vent.trigger("backend:switchfrontend",tb_app.redirectFrontend)}},e=function(){c.saveBlock()};f.registerBlockType("themify-builder/canvas",{title:"Themify Builder",icon:"layout",
category:"layout",useOnce:!0,edit(a){setTimeout(function(){c.saveHTML(a);c.restoreHTML(a);c.manageState(a);Themify.trigger("tb_canvas_loaded")},800);return h("div",{id:"tb_canvas_block"},"placeholder builder")},save(){return null}});b(function(){b("body").on("click",".editor-post-publish-button, .editor-post-save-draft",function(a){tb_app.hasChanged&&tb_app.Utils.saveBuilder(function(){d=!0})}).off("click.frontend-btn","#tb_switch_frontend").on("click.frontend-btn","#tb_switch_frontend",function(){b(".editor-post-publish-button").on("DOMSubtreeModified",
function(){this.classList.contains("is-busy")||b(".editor-post-saved-state").length||(d=!1,e())})})});b(document).ajaxComplete(function(a,b,c){"POST"===c.type&&void 0!==window.themifyBuilder&&themifyBuilder.post_ID&&-1!==c.url.indexOf("post.php?post="+themifyBuilder.post_ID+"&action=edit&classic-editor=1&meta_box=1")&&setTimeout(e,800)})})(window.wp.blocks,window.wp.i18n,window.wp.element,jQuery);
